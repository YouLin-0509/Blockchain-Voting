下面以 **流程脈絡 → 交互步驟 → 正確性／效率要點** 的順序，完整說明 **VeRange Type-1** （下稱 T1）零知識範圍論證的運作細節。

---

### 1. 觀念脈絡：把「票值在合法範圍」化成可驗證的等式

1. **比特分解**

   * 將票值 ω 寫成長度 N 的位元向量 b=(b₁…b\_N)，滿足
     ω = ∑ bᵢ·2^{i-1}。
2. **矩陣重排**

   * 把 b 填入 J×K 矩陣 $\hat b_{j,k}$，同時準備同形矩陣 $\hat 2_{j,k}=2^{J(k-1)+j-1}$。
   * 定義 $w_{j,k}= \hat b_{j,k}\cdot\hat 2_{j,k}$。
3. **關鍵約束**

   * 只要對所有 (j,k) 有
     $w_{j,k}\in\{0,\hat 2_{j,k}\}$ 且
     $\sum_{j,k} w_{j,k}=ω$，
     即可保證 ω 確實落在 $[0,2^{N}-1]$ 的合法範圍。

T1 的任務就是在 **不公開 ω 及 b** 的情況下，讓驗證者相信上述約束成立。

---

### 2. 交互協定（Πᵗʸ¹）逐步拆解

> 下面對應論文 Figure 1 中的 6 個訊息輪次 。

| 步驟                | 通訊方向  | 內容 & 作用                                                                                                                                                                                              |
| ----------------- | ----- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. 承諾（Commit）** | P → V | <br>• 對每一欄 k 提交 Pedersen 承諾 $W_k = G^{∑_j w_{j,k}}Q^{r^{(W)}_k}$<br>• 為後續驗證準備隨機量 r\_{j,k}，並提交輔助承諾 $T_k, R, S$。                                                                                       |
| **2. 挑戰**         | V → P | 隨機向量 **ε** ∈ 𝔽ₚ^K                                                                                                                                                                                   |
| **3. 響應**         | P → V | 回覆 $v_{j,k}=w_{j,k}·ε_k+r_{j,k}$ 以及彙整用隨機值 η₁, η₂。                                                                                                                                                    |
| **4–6. 鏈式驗證**     | 本地    | 驗證者計算 $u_{j,k}= \hat 2_{j,k}·ε_k - v_{j,k}$，並檢查三條核心等式：<br>① $∏_j H_j^{∑_k v_{j,k}u_{j,k}}Q^{η₁} = ∏_k T_k^{ε_k} S$<br>② $G^{∑_{j,k} v_{j,k}}Q^{η₂} = ∏_k W_k^{ε_k} R$<br>③ $G^{ω}Q^{r_ω} = ∏_k W_k$。 |

若三式同時成立，則 (i) 每個 w\_{j,k} 非 0 即 $\hat 2_{j,k}$，(ii) 其加總確為 ω，從而證明 ω 在合法範圍，而 **不洩漏任何 w 或 ω 本身**。

---

### 3. 正確性、零知識與效率

| 指標           | T1 數值                                          | 說明                          |
| ------------ | ---------------------------------------------- | --------------------------- |
| **證明大小**     | ≈ 2√N 個群元素 + N 個欄位元素                           | 主要來自 (W\_k, T\_k) 與 v 陣列    |
| **驗證者計算量**   | 3 √N 次群指數運算                                    | 相對 Bulletproofs 的 O(N) 大幅下降 |
| **建立者計算量**   | N + 4√N 次群指數運算                                 | 包含產生 v 與各承諾                 |
| **透明／無信任設定** | 僅需隨機公用基底 (Ḡ, Q, H\_j)；無 trusted setup         |                             |
| **零知識**      | 透過隨機遮罩 r\_{j,k}、η₁、η₂ 和 Fiat-Shamir 轉換保證模擬器可重現 |                             |

---

### 4. 批次聚合（Aggregated T1）

若一次要驗證 T 張票，可先用隨機係數 γₜ 對每張票做一次線性組合，只提交一份聚合證明；
驗證成本從 T × 3√N 降至 **3√(TN) + T**，非常適合大量選民情境。

---

### 5. 實務整合小結

1. **鏈上驗證**：在 EVM 中以預編譯或 Solidity library 呼叫 `verifyVeRange()`；64-bit T1 約 25–30 萬 gas，一張票成本 < US\$1 （假設 7 gwei）。
2. **鏈下產證**：於前端或批次服務端（WebWorker/Rust CLI）產生 (ω, r, π) 後僅把承諾與證明送鏈。
3. **與匿名身份**：T1 本身不含身份；可並用 Ring Signature 於另一路徑隱匿 voter。

---

#### ▍一句話總結

**VeRange Type-1 將「數值落在指定範圍」轉換為只需 3√N 次驗證運算的群等式檢查，透過 6 步交互（後可 Fiat-Shamir 去交互）達成無需可信設定、證明短小、驗證高效的零知識範圍論證。**
